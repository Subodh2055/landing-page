<div class="cart-container">
  <div class="cart-header">
    <h1><i class="fas fa-shopping-cart"></i> Shopping Cart</h1>
    <p *ngIf="cartItems.length > 0">{{ cartItems.length }} items in your cart</p>
  </div>

  <!-- Empty Cart State -->
  <div *ngIf="cartItems.length === 0 && savedForLater.length === 0" class="empty-cart">
    <div class="empty-cart-content">
      <i class="fas fa-shopping-cart"></i>
      <h2>Your cart is empty</h2>
      <p>Looks like you haven't added any items to your cart yet.</p>
      <button class="btn btn-primary" (click)="navigateToProducts()">
        <i class="fas fa-shopping-bag"></i>
        Start Shopping
      </button>
    </div>
  </div>

  <!-- Cart Content -->
  <div *ngIf="cartItems.length > 0 || savedForLater.length > 0" class="cart-content">
    <div class="cart-main">
      <!-- Cart Items -->
      <div *ngIf="cartItems.length > 0" class="cart-items-section">
        <h2>Cart Items ({{ cartItems.length }})</h2>
        
        <div class="cart-items">
          <div *ngFor="let item of cartItems; trackBy: trackByItem" class="cart-item">
            <div class="item-image">
              <img [src]="item.product.image" [alt]="item.product.name">
            </div>
            
            <div class="item-details">
              <h3>{{ item.product.name }}</h3>
              <p class="item-category">{{ item.product.category }}</p>
              <p class="item-price">₹{{ item.product.price }}</p>
              
              <div class="item-actions">
                <div class="quantity-controls">
                  <button class="qty-btn" (click)="updateQuantity(item, item.quantity - 1)">
                    <i class="fas fa-minus"></i>
                  </button>
                  <span class="quantity">{{ item.quantity }}</span>
                  <button class="qty-btn" (click)="updateQuantity(item, item.quantity + 1)">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                
                <div class="item-total">
                  <span>Total: ₹{{ item.product.price * item.quantity }}</span>
                </div>
              </div>
            </div>
            
            <div class="item-actions-main">
              <button class="action-btn save-later" (click)="saveForLater(item)">
                <i class="fas fa-bookmark"></i>
                Save for Later
              </button>
              <button class="action-btn remove" (click)="removeFromCart(item)">
                <i class="fas fa-trash"></i>
                Remove
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Saved for Later -->
      <div *ngIf="savedForLater.length > 0" class="saved-for-later-section">
        <h2>Saved for Later ({{ savedForLater.length }})</h2>
        
        <div class="saved-items">
          <div *ngFor="let item of savedForLater; trackBy: trackByItem" class="saved-item">
            <div class="item-image">
              <img [src]="item.product.image" [alt]="item.product.name">
            </div>
            
            <div class="item-details">
              <h3>{{ item.product.name }}</h3>
              <p class="item-category">{{ item.product.category }}</p>
              <p class="item-price">₹{{ item.product.price }}</p>
            </div>
            
            <div class="item-actions-main">
              <button class="action-btn move-to-cart" (click)="moveToCart(item)">
                <i class="fas fa-shopping-cart"></i>
                Move to Cart
              </button>
              <button class="action-btn remove" (click)="removeFromSaved(item)">
                <i class="fas fa-trash"></i>
                Remove
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cart Summary -->
    <div class="cart-summary">
      <div class="summary-card">
        <h2>Order Summary</h2>
        
        <!-- Delivery Address -->
        <div class="summary-section">
          <h3><i class="fas fa-map-marker-alt"></i> Delivery Address</h3>
          <div *ngIf="selectedAddress" class="selected-address">
            <p><strong>{{ selectedAddress.name }}</strong></p>
            <p>{{ selectedAddress.getFullAddress() }}</p>
            <p>Phone: {{ selectedAddress.getFormattedPhone() }}</p>
          </div>
          <button class="btn btn-secondary" (click)="addNewAddress()">
            <i class="fas fa-plus"></i>
            Add New Address
          </button>
        </div>

        <!-- Delivery Estimate -->
        <div class="summary-section">
          <h3><i class="fas fa-truck"></i> Delivery Estimate</h3>
          <div class="delivery-info">
            <p><strong>Estimated Delivery:</strong> {{ deliveryEstimate }}</p>
            <p><strong>Delivery Time:</strong> 3-5 business days</p>
            <p *ngIf="isEligibleForFreeShipping()" class="free-shipping">
              <i class="fas fa-check-circle"></i> Free Shipping
            </p>
            <p *ngIf="!isEligibleForFreeShipping()" class="shipping-info">
              Add ₹{{ 1000 - subtotal | number:'1.0-0' }} more for free shipping
            </p>
          </div>
        </div>

        <!-- Coupon Section -->
        <div class="summary-section">
          <h3><i class="fas fa-tag"></i> Coupons & Offers</h3>
          
          <div *ngIf="appliedCoupon" class="applied-coupon">
            <div class="coupon-info">
              <span class="coupon-code">{{ appliedCoupon.code }}</span>
              <span class="coupon-discount">{{ getCouponDiscountText() }}</span>
            </div>
            <button class="btn btn-sm btn-danger" (click)="removeCoupon()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <button *ngIf="!appliedCoupon" class="btn btn-secondary" (click)="showCouponModal = true">
            <i class="fas fa-plus"></i>
            Apply Coupon
          </button>
        </div>

        <!-- Payment Methods -->
        <div class="summary-section">
          <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
          
          <div class="payment-methods">
            <!-- Traditional Payment Methods -->
            <div class="payment-category">
              <h4>Traditional Methods</h4>
              <div class="payment-options">
                <div *ngFor="let method of paymentMethods | slice:0:4" 
                     class="payment-option"
                     [class.selected]="selectedPaymentMethod?.id === method.id"
                     (click)="selectPaymentMethod(method)">
                  <i [class]="method.icon"></i>
                  <div class="method-info">
                    <span class="method-name">{{ method.name }}</span>
                    <span class="method-desc">{{ method.description }}</span>
                  </div>
                  <div class="method-badge" *ngIf="method.isRecommended()">Recommended</div>
                </div>
              </div>
            </div>

            <!-- Nepali Payment Methods -->
            <div class="payment-category">
              <h4>Nepali Payment Methods</h4>
              <div class="payment-options">
                <div *ngFor="let method of paymentMethods | slice:4:10" 
                     class="payment-option nepali-method"
                     [class.selected]="selectedPaymentMethod?.id === method.id"
                     (click)="selectPaymentMethod(method)">
                  <i [class]="method.icon"></i>
                  <div class="method-info">
                    <span class="method-name">{{ method.name }}</span>
                    <span class="method-desc">{{ method.description }}</span>
                  </div>
                  <div class="method-badge" *ngIf="method.isRecommended()">Recommended</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Price Breakdown -->
        <div class="summary-section">
          <h3><i class="fas fa-receipt"></i> Price Details</h3>
          
          <div class="price-breakdown">
            <div class="price-row">
              <span>Subtotal ({{ cartItems.length }} items)</span>
              <span>₹{{ subtotal | number:'1.0-2' }}</span>
            </div>
            
            <div class="price-row">
              <span>Tax (18% GST)</span>
              <span>₹{{ tax | number:'1.0-2' }}</span>
            </div>
            
            <div class="price-row">
              <span>Shipping</span>
              <span *ngIf="shipping === 0" class="free">Free</span>
              <span *ngIf="shipping > 0">₹{{ shipping | number:'1.0-2' }}</span>
            </div>
            
            <div *ngIf="discount > 0" class="price-row discount">
              <span>Discount</span>
              <span>-₹{{ discount | number:'1.0-2' }}</span>
            </div>
            
            <div class="price-row total">
              <span><strong>Total</strong></span>
              <span><strong>₹{{ total | number:'1.0-2' }}</strong></span>
            </div>
          </div>
        </div>

        <!-- Checkout Button -->
        <div class="checkout-section">
          <button class="btn btn-primary btn-large" (click)="proceedToCheckout()">
            <i class="fas fa-lock"></i>
            Proceed to Checkout
          </button>
          <p class="secure-checkout">
            <i class="fas fa-shield-alt"></i>
            Secure checkout with SSL encryption
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Coupon Modal -->
  <div *ngIf="showCouponModal" class="modal-overlay" (click)="closeCouponModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Apply Coupon</h3>
        <button class="close-btn" (click)="closeCouponModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="coupon-input">
          <input type="text" 
                 [(ngModel)]="couponCode" 
                 placeholder="Enter coupon code"
                 (keyup.enter)="applyCoupon()">
          <button class="btn btn-primary" (click)="applyCoupon()">
            Apply
          </button>
        </div>
        
        <div class="available-coupons">
          <h4>Available Coupons</h4>
          <div class="coupon-list">
            <div *ngFor="let coupon of availableCoupons" class="coupon-item">
              <div class="coupon-header">
                <span class="coupon-code">{{ coupon.code }}</span>
                <span class="coupon-value">{{ coupon.getFormattedValue() }} OFF</span>
              </div>
              <p class="coupon-name">{{ coupon.name }}</p>
              <p class="coupon-desc">{{ coupon.description }}</p>
              <div class="coupon-conditions">
                <span class="min-order">{{ coupon.getMinOrderText() }}</span>
                <span class="validity">{{ coupon.getValidityText() }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Address Modal -->
<div class="modal fade" [class.show]="showAddressModal" [style.display]="showAddressModal ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Address</h5>
        <button type="button" class="btn-close" (click)="closeAddressModal()"></button>
      </div>
      <div class="modal-body">
        <!-- Address form would go here -->
        <p>Address form implementation would go here.</p>
      </div>
    </div>
  </div>
</div>

