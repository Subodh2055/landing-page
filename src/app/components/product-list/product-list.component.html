<div class="full-width mt-4 px-4 py-4">
  <!-- Mobile Header -->
  <div class="mobile-header d-lg-none">
    <div class="mobile-title">
      <h2 class="fw-bold text-dark">
        <i class="fas fa-th-large me-2"></i>
        {{ currentUser ? 'Your Products' : 'Public Products' }}
      </h2>
      <p class="text-muted">
        {{ currentUser ? 'Access your role-based product collection' : 'Browse our public product catalog' }}
      </p>
    </div>
    <div class="mobile-actions" *ngIf="currentUser && hasRole('admin')">
      <a (click)="navigateToAdmin()" class="btn btn-primary btn-sm">
        <i class="fas fa-plus me-1"></i>Add Product
      </a>
    </div>
  </div>

  <!-- Mobile Search and Filter Bar -->
  <div class="d-lg-none mb-3">
    <div class="row g-2">
      <div class="col-8">
        <div class="search-container">
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Search products..."
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()">
          </div>
        </div>
      </div>
      <div class="col-4">
        <button 
          class="btn btn-outline-primary w-100" 
          (click)="toggleMobileFilters()"
          [class.active]="showMobileFilters">
          <i class="fas fa-filter me-1"></i>
          Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Filter Info -->
  <div class="d-lg-none mb-3" *ngIf="!loading && filteredProducts.length > 0">
    <div class="filter-info text-center">
      <span class="text-muted">
        Showing {{ startIndex + 1 }}-{{ endIndex }} of {{ filteredProducts.length }} products
      </span>
    </div>
  </div>

  <!-- Desktop Header -->
  <div class="row mb-4 d-none d-lg-flex">
    <div class="col-md-6">
      <h2 class="fw-bold text-dark">
        <i class="fas fa-th-large me-2"></i>
        {{ currentUser ? 'Your Products' : 'Public Products' }}
      </h2>
      <p class="text-muted">
        {{ currentUser ? 'Access your role-based product collection' : 'Browse our public product catalog' }}
      </p>
    </div>
    <div class="col-md-6 text-end" *ngIf="currentUser && hasRole('admin')">
      <a (click)="navigateToAdmin()" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Add New Product
      </a>
    </div>
  </div>

  <!-- Desktop Layout - Side by Side -->
  <div class="row d-none d-lg-flex">
    <!-- Desktop Sidebar -->
    <div class="col-md-3">
      <app-sidebar
        [availableCategories]="availableCategories"
        [selectedCategories]="selectedCategories"
        [priceRange]="priceRange"
        [maxPrice]="maxPrice"
        [inStockOnly]="inStockOnly"
        [sortBy]="sortBy"
        [hasActiveFilters]="hasActiveFilters()"
        [isMobile]="false"
        [categoryCounts]="getCategoryCounts()"
        (categoryChange)="onCategoryChange($event)"
        (priceRangeChange)="onPriceRangeChange($event)"
        (stockChange)="onStockChange($event)"
        (sortChange)="onSortChange($event)"
        (clearAll)="clearFilters()"
        (removeCategory)="removeCategoryFilter($event)"
        (clearPrice)="clearPriceFilter()"
        (removeStock)="removeStockFilter()">
      </app-sidebar>
    </div>

    <!-- Desktop Content -->
    <div class="col-md-9">
      <!-- Search and Filter Section -->
      <div class="row mb-4" *ngIf="!loading && products.length > 0">
        <div class="col-md-6">
          <div class="search-container">
            <div class="input-group">
              <span class="input-group-text">
                <i class="fas fa-search"></i>
              </span>
              <input 
                type="text" 
                class="form-control" 
                placeholder="Search products by name..."
                [(ngModel)]="searchTerm"
                (input)="onSearchChange()">
            </div>
          </div>
        </div>
        <div class="col-md-6 text-end">
          <div class="filter-info">
            <span class="text-muted">
              Showing {{ startIndex + 1 }}-{{ endIndex }} of {{ filteredProducts.length }} products
            </span>
          </div>
        </div>
      </div>

      <!-- Product Grid -->
      <div class="row g-3" *ngIf="!loading && paginatedProducts.length > 0">
        <div class="col-12 col-sm-6 col-lg-3 col-xl-2" *ngFor="let product of paginatedProducts; trackBy: trackByProduct">
          <app-product-card [product]="product"></app-product-card>
        </div>
      </div>

      <!-- Loading State -->
      <div class="row" *ngIf="loading">
        <div class="col-12 text-center">
          <div class="spinner mx-auto"></div>
          <p class="text-dark mt-3">Loading products...</p>
        </div>
      </div>

      <!-- Empty State -->
      <div class="row" *ngIf="!loading && filteredProducts.length === 0">
        <div class="col-12 text-center">
          <div class="text-dark">
            <i class="fas fa-search fa-3x mb-3"></i>
            <h3>No products found</h3>
            <p *ngIf="searchTerm">No products match your search for "{{ searchTerm }}"</p>
            <p *ngIf="!searchTerm">Check back later for new products!</p>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="row mt-5" *ngIf="!loading && filteredProducts.length > 0">
        <div class="col-12">
          <nav aria-label="Product pagination">
            <ul class="pagination justify-content-center">
              <!-- Previous Button -->
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" href="#" (click)="goToPage(currentPage - 1); $event.preventDefault()">
                  <i class="fas fa-chevron-left"></i>
                </a>
              </li>
              
              <!-- First Page -->
              <li class="page-item" *ngIf="currentPage > 3">
                <a class="page-link" href="#" (click)="goToPage(1); $event.preventDefault()">1</a>
              </li>
              
              <!-- Ellipsis -->
              <li class="page-item disabled" *ngIf="currentPage > 4">
                <span class="page-link">...</span>
              </li>
              
              <!-- Page Numbers -->
              <li class="page-item" 
                  *ngFor="let page of getVisiblePages()" 
                  [class.active]="page === currentPage">
                <a class="page-link" href="#" (click)="goToPage(page); $event.preventDefault()">{{ page }}</a>
              </li>
              
              <!-- Ellipsis -->
              <li class="page-item disabled" *ngIf="currentPage < totalPages - 3">
                <span class="page-link">...</span>
              </li>
              
              <!-- Last Page -->
              <li class="page-item" *ngIf="currentPage < totalPages - 2">
                <a class="page-link" href="#" (click)="goToPage(totalPages); $event.preventDefault()">{{ totalPages }}</a>
              </li>
              
              <!-- Next Button -->
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <a class="page-link" href="#" (click)="goToPage(currentPage + 1); $event.preventDefault()">
                  <i class="fas fa-chevron-right"></i>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Sidebar Overlay -->
  <div class="mobile-sidebar-overlay" 
       [class.active]="showMobileFilters" 
       (click)="closeMobileFilters()">
  </div>

  <!-- Mobile Sidebar -->
  <div class="mobile-sidebar" [class.active]="showMobileFilters">
    <div class="mobile-sidebar-header">
      <h5 class="mb-0">
        <i class="fas fa-filter me-2"></i>
        Filters
      </h5>
      <button class="btn-close" (click)="closeMobileFilters()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="mobile-sidebar-content">
      <app-sidebar
        [availableCategories]="availableCategories"
        [selectedCategories]="selectedCategories"
        [priceRange]="priceRange"
        [maxPrice]="maxPrice"
        [inStockOnly]="inStockOnly"
        [sortBy]="sortBy"
        [hasActiveFilters]="hasActiveFilters()"
        [isMobile]="true"
        [categoryCounts]="getCategoryCounts()"
        (categoryChange)="onCategoryChange($event)"
        (priceRangeChange)="onPriceRangeChange($event)"
        (stockChange)="onStockChange($event)"
        (sortChange)="onSortChange($event)"
        (clearAll)="clearMobileFilters()"
        (removeCategory)="removeCategoryFilter($event)"
        (clearPrice)="clearPriceFilter()"
        (removeStock)="removeStockFilter()">
      </app-sidebar>
    </div>
  </div>
  
  <!-- Mobile Product Grid with Infinite Scroll -->
  <div class="mobile-products-container" 
       appInfiniteScroll 
       [threshold]="100"
       [disabled]="loading || currentPage >= totalPages"
       (scrolled)="loadMoreProducts()">
    <div class="row g-2 d-lg-none" *ngIf="!loading && paginatedProducts.length > 0">
      <div class="col-12 col-sm-6" *ngFor="let product of paginatedProducts; trackBy: trackByProduct">
        <app-product-card [product]="product"></app-product-card>
      </div>
    </div>
    
    <!-- Loading more indicator -->
    <div class="row d-lg-none" *ngIf="loading && paginatedProducts.length > 0">
      <div class="col-12 text-center">
        <app-skeleton-loader type="card" [count]="2"></app-skeleton-loader>
      </div>
    </div>
  </div>

  <!-- Mobile Loading State -->
  <div class="row d-lg-none" *ngIf="loading && !paginatedProducts.length">
    <div class="col-12">
      <app-skeleton-loader type="card" [count]="6"></app-skeleton-loader>
    </div>
  </div>

  <!-- Mobile No Products State -->
  <div class="row d-lg-none" *ngIf="!loading && filteredProducts.length === 0">
    <div class="col-12 text-center">
      <div class="text-dark">
        <i class="fas fa-search fa-3x mb-3"></i>
        <h3>No products found</h3>
        <p *ngIf="searchTerm">No products match your search for "{{ searchTerm }}"</p>
        <p *ngIf="!searchTerm">Check back later for new products!</p>
      </div>
    </div>
  </div>

  <!-- Mobile Pagination -->
  <div class="d-lg-none mt-4" *ngIf="!loading && filteredProducts.length > 0">
    <nav aria-label="Mobile product pagination">
      <ul class="pagination justify-content-center">
        <!-- Previous Button -->
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" href="#" (click)="goToPage(currentPage - 1); $event.preventDefault()">
            <i class="fas fa-chevron-left"></i>
          </a>
        </li>
        
        <!-- Page Numbers (Simplified for mobile) -->
        <li class="page-item" 
            *ngFor="let page of getVisiblePages()" 
            [class.active]="page === currentPage">
          <a class="page-link" href="#" (click)="goToPage(page); $event.preventDefault()">{{ page }}</a>
        </li>
        
        <!-- Next Button -->
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" href="#" (click)="goToPage(currentPage + 1); $event.preventDefault()">
            <i class="fas fa-chevron-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
